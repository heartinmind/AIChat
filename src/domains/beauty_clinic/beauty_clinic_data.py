# customer_service/rag/beauty_clinic_data.py
"""
실제 뷰티 클리닉 데이터 for RAG 시스템
"""

REAL_BEAUTY_TREATMENTS = {
    "보톡스": {
        "부위": ["이마", "눈가", "미간", "턱라인", "사각근"],
        "가격": {
            "이마": 150000,
            "눈가": 200000, 
            "미간": 120000,
            "턱라인": 300000,
            "사각근": 250000
        },
        "시술시간": "15-30분",
        "효과지속": "4-6개월",
        "부작용": "일시적 멍, 붓기",
        "주의사항": [
            "시술 후 4시간 눕지 말기",
            "24시간 사우나/찜질방 금지",
            "3일간 심한 운동 피하기",
            "술, 아스피린 일주일 금지"
        ],
        "적합한_피부타입": ["모든 피부"],
        "연령대": "25-65세",
        "재시술_주기": "4-6개월"
    },
    
    "필러": {
        "종류": {
            "히알루론산": {
                "브랜드": ["레스틸렌", "쥬비덤", "벨로테로"],
                "지속기간": "12-18개월",
                "가격_per_cc": 400000
            },
            "칼슘": {
                "브랜드": ["레디어스"],
                "지속기간": "18-24개월", 
                "가격_per_cc": 600000
            }
        },
        "시술부위": {
            "볼": {"권장량": "1-2cc", "가격": 400000},
            "코": {"권장량": "0.5-1cc", "가격": 300000},
            "입술": {"권장량": "0.5-1cc", "가격": 350000},
            "턱": {"권장량": "1-2cc", "가격": 450000},
            "이마": {"권장량": "1-1.5cc", "가격": 400000}
        },
        "부작용": [
            "일시적 붓기 (2-3일)",
            "멍 (1주일)",
            "비대칭 (드물게)",
            "혈관 폐색 (매우 드물게)"
        ],
        "금기사항": [
            "임신, 수유 중",
            "자가면역질환",
            "켈로이드 체질",
            "혈액응고장애"
        ]
    },

    "레이저": {
        "피코레이저": {
            "적응증": ["기미", "주근깨", "문신제거", "모공축소"],
            "세션수": "5-10회",
            "간격": "2-4주",
            "가격_per_session": 150000,
            "회복기간": "3-5일",
            "효과": "색소 90% 개선"
        },
        "프락셔널레이저": {
            "적응증": ["여드름흉터", "모공", "주름", "색소"],
            "세션수": "3-5회", 
            "간격": "4-6주",
            "가격_per_session": 300000,
            "회복기간": "5-7일",
            "효과": "흉터 70% 개선"
        },
        "IPL": {
            "적응증": ["홍조", "색소", "모세혈관확장"],
            "세션수": "5-8회",
            "간격": "2-3주", 
            "가격_per_session": 120000,
            "회복기간": "1-2일",
            "효과": "색소/홍조 80% 개선"
        }
    },

    "스킨케어": {
        "하이드라페이셜": {
            "단계": [
                "클렌징 + 각질제거",
                "산 필링",
                "무통 추출",
                "히드레이션",
                "안티옥시던트 보호"
            ],
            "시술시간": "30-45분",
            "가격": 150000,
            "주기": "2-4주",
            "효과": "즉시 글로우, 모공 개선",
            "적합": "모든 피부 타입"
        },
        "아쿠아필": {
            "특징": "수분 공급 + 진정",
            "시술시간": "45분",
            "가격": 120000,
            "주기": "2주",
            "효과": "수분 충전, 진정",
            "적합": "건성, 민감성 피부"
        },
        "옥시젠": {
            "특징": "산소 + 비타민 주입",
            "시술시간": "50분", 
            "가격": 180000,
            "주기": "3-4주",
            "효과": "안티에이징, 생기",
            "적합": "피곤하고 칙칙한 피부"
        }
    }
}

CUSTOMER_CONSULTATION_SCENARIOS = [
    {
        "고객_프로필": {
            "나이": 28,
            "성별": "여성",
            "피부타입": "지복합성",
            "주요_고민": ["이마 주름", "눈가 잔주름"],
            "예산": "50만원 이하",
            "시술_경험": "없음",
            "직업": "회사원",
            "라이프스타일": "야근 많음, 스트레스 많음"
        },
        "상담_시나리오": {
            "초기_질문": "안녕하세요. 이마랑 눈가 주름이 신경 쓰여서 상담 받고 싶어요. 보톡스를 생각하고 있는데 처음이라 무서워요.",
            "예상_추천": ["보톡스 (이마+눈가)", "스킨케어 병행"],
            "가격_범위": "350,000-400,000원",
            "시술_순서": "스킨케어 먼저 → 2주 후 보톡스",
            "사후관리": ["선크림 필수", "충분한 수면", "스트레스 관리"]
        }
    },
    
    {
        "고객_프로필": {
            "나이": 35,
            "성별": "여성", 
            "피부타입": "건성",
            "주요_고민": ["볼 처짐", "법령선", "마리오네트라인"],
            "예산": "100만원 이하",
            "시술_경험": "보톡스 2회",
            "직업": "자영업자",
            "라이프스타일": "규칙적, 건강관리 잘함"
        },
        "상담_시나리오": {
            "초기_질문": "볼이 많이 처져서 나이가 들어 보여요. 필러나 실리프팅 같은 걸 생각하고 있는데 어떤 게 좋을까요?",
            "예상_추천": ["히알루론산 필러 (볼+법령선)", "울쎄라 리프팅"],
            "가격_범위": "800,000-1,200,000원",
            "시술_순서": "필러 먼저 → 4주 후 울쎄라",
            "사후관리": ["마사지 금지", "금주 1주일", "콜라겐 관리"]
        }
    },

    {
        "고객_프로필": {
            "나이": 42,
            "성별": "남성",
            "피부타입": "지성",
            "주요_고민": ["사각턱", "이중턱", "넓은 모공"],
            "예산": "제한 없음",
            "시술_경험": "레이저 토닝 경험",
            "직업": "의사",
            "라이프스타일": "바쁨, 효과 중시"
        },
        "상담_시나리오": {
            "초기_질문": "사각턱이 너무 커서 인상이 세어 보여요. 보톡스로 해결되나요? 그리고 모공도 함께 관리하고 싶어요.",
            "예상_추천": ["사각근 보톡스", "프락셔널 레이저", "메조테라피"],
            "가격_범위": "600,000-800,000원",
            "시술_순서": "레이저 먼저 → 2주 후 보톡스",
            "사후관리": ["딱딱한 음식 피하기", "꾸준한 홈케어"]
        }
    }
]

CLINIC_POLICIES = {
    "예약_정책": {
        "취소_가능": "24시간 전까지",
        "변경_가능": "48시간 전까지", 
        "노쇼_정책": "예약금 50% 차감",
        "당일_예약": "가능 (빈 시간대 있을 시)"
    },
    
    "결제_정책": {
        "예약금": "시술비의 30%",
        "결제_방법": ["현금", "카드", "계좌이체", "할부"],
        "할부_조건": "50만원 이상 시 무이자 6개월",
        "환불_정책": "시술 전 100%, 시술 후 불가"
    },
    
    "사후관리": {
        "상담": "시술 후 1주일, 1개월 무료",
        "AS_정책": "부작용 발생 시 무료 치료",
        "재시술": "만족도 낮을 시 50% 할인",
        "멤버십": "연 200만원 이상 시 VIP 혜택"
    },

    "안전_수칙": {
        "시술_전": [
            "음주 3일 전부터 금지",
            "아스피린 1주일 전부터 중단",
            "수면 충분히 취하기",
            "컨디션 난조 시 연기"
        ],
        "시술_후": [
            "냉찜질 2-3일",
            "자외선 차단 철저",
            "사우나/찜질방 1주일 금지",
            "음주 1주일 금지"
        ]
    }
}

# RAG에 사용할 임베딩용 텍스트 생성
def generate_rag_documents():
    """RAG 시스템에 입력할 문서들을 생성"""
    documents = []
    
    # 시술 정보 문서화
    for treatment, details in REAL_BEAUTY_TREATMENTS.items():
        doc = f"시술명: {treatment}\n"
        doc += f"상세정보: {str(details)}\n"
        doc += f"검색키워드: {treatment}, 뷰티, 성형, 시술\n"
        documents.append(doc)
    
    # 상담 시나리오 문서화  
    for i, scenario in enumerate(CUSTOMER_CONSULTATION_SCENARIOS):
        doc = f"상담사례 {i+1}\n"
        doc += f"고객프로필: {str(scenario['고객_프로필'])}\n"
        doc += f"상담내용: {str(scenario['상담_시나리오'])}\n"
        documents.append(doc)
    
    # 클리닉 정책 문서화
    for policy, details in CLINIC_POLICIES.items():
        doc = f"정책: {policy}\n"
        doc += f"내용: {str(details)}\n"
        documents.append(doc)
    
    return documents

# 고객 시뮬레이션 함수
def simulate_customer_consultation(customer_profile, initial_question):
    """고객 상담 시뮬레이션"""
    
    # 고객 프로필 기반 추천 로직
    age = customer_profile.get('나이', 30)
    concerns = customer_profile.get('주요_고민', [])
    budget = customer_profile.get('예산', '제한없음')
    experience = customer_profile.get('시술_경험', '없음')
    
    recommendations = []
    
    # 나이대별 추천
    if age < 30:
        if '주름' in str(concerns):
            recommendations.append("보톡스 (소량)")
        recommendations.append("스킨케어 집중")
    elif age < 40:
        if '주름' in str(concerns):
            recommendations.append("보톡스")
        if '볼처짐' in str(concerns):
            recommendations.append("필러")
    else:
        recommendations.extend(["리프팅", "필러", "보톡스"])
    
    # 예산 고려 필터링
    if '50만원' in budget:
        recommendations = [r for r in recommendations if r in ['보톡스', '스킨케어']]
    
    return {
        "고객질문": initial_question,
        "AI추천": recommendations,
        "상담방향": f"{age}세 {customer_profile.get('성별', '')}분을 위한 맞춤 상담",
        "예상시술순서": "상담 → 패치테스트 → 시술 → 사후관리"
    }
